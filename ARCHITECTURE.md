# Gitã§ç›†æ ½ - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
git-bonsai-visualizer/
â”œâ”€â”€ index.html          # ãƒ¡ã‚¤ãƒ³HTMLï¼ˆSVGã‚­ãƒ£ãƒ³ãƒã‚¹å®šç¾©ï¼‰
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css      # ã‚¹ã‚¿ã‚¤ãƒ«
â””â”€â”€ js/
    â”œâ”€â”€ main.js        # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    â”œâ”€â”€ git-parser.js  # Gitãƒªãƒã‚¸ãƒˆãƒªè§£æ
    â”œâ”€â”€ bonsai-layout.js  # ç›†æ ½ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—
    â”œâ”€â”€ svg-renderer.js   # SVGæç”»
    â””â”€â”€ ui-controller.js  # UIåˆ¶å¾¡
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ãƒ¦ãƒ¼ã‚¶ãƒ¼                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UIController                           â”‚
â”‚  ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°                                 â”‚
â”‚  ãƒ»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º                                       â”‚
â”‚  ãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤º                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ directoryHandle
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitParser                             â”‚
â”‚  1. .gitãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’LightningFSã«ã‚³ãƒ”ãƒ¼                â”‚
â”‚  2. isomorphic-gitã§ãƒ­ã‚°å–å¾—ï¼ˆæœ€å¤§1000ã‚³ãƒŸãƒƒãƒˆï¼‰         â”‚
â”‚  3. ã‚³ãƒŸãƒƒãƒˆã‚°ãƒ©ãƒ•ã‚’æ§‹ç¯‰                                  â”‚
â”‚  4. è¦ªå­é–¢ä¿‚ã‚’æ§‹ç¯‰                                        â”‚
â”‚  5. æ·±ã•(depth)ã‚’è¨ˆç®—                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ {commits: Map, branches: Map}
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BonsaiLayout                            â”‚
â”‚  1. ãƒ«ãƒ¼ãƒˆã‚³ãƒŸãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹                              â”‚
â”‚  2. ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®šï¼ˆroot/trunk/merge/leafï¼‰          â”‚
â”‚  3. åº§æ¨™ã‚’è¨ˆç®—ï¼ˆæ¨ªæ–¹å‘Ã—3.0ã€ç¸¦æ–¹å‘Ã—0.3ï¼‰                â”‚
â”‚  4. è¡çªã‚’è§£æ¶ˆ                                            â”‚
â”‚  5. ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ãƒ•ã‚£ãƒƒãƒˆ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ nodes: Array<GraphNode>
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SVGRenderer                             â”‚
â”‚  1. æ¤æœ¨é‰¢ã‚’æç”»ï¼ˆé€†å°å½¢ï¼‰                                â”‚
â”‚  2. æã‚’æç”»ï¼ˆç·šï¼‰                                        â”‚
â”‚  3. è‘‰ã‚’æç”»ï¼ˆæ¥•å††ï¼‰                                      â”‚
â”‚  4. ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ©Ÿèƒ½                                      â”‚
â”‚  5. ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

### 1. GitParser: ãƒªãƒã‚¸ãƒˆãƒªè§£æ

```
Gitãƒªãƒã‚¸ãƒˆãƒª
    â”‚
    â–¼ .gitãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚³ãƒ”ãƒ¼
LightningFS (ä»®æƒ³FS)
    â”‚
    â–¼ isomorphic-git
git.log({depth: 1000})
    â”‚
    â–¼ ç”Ÿãƒ‡ãƒ¼ã‚¿
[
  {
    oid: "abc123",
    commit: {
      parent: ["def456"],
      message: "Initial commit",
      author: {...}
    }
  },
  ...
]
    â”‚
    â–¼ buildCommitGraph()
ã‚³ãƒŸãƒƒãƒˆãƒãƒƒãƒ—: Map<sha, Commit>
{
  "abc123": {
    sha: "abc123",
    parents: ["def456"],
    children: ["ghi789"],
    message: "Initial commit",
    depth: 0,
    isMerge: false,
    branchName: "main"
  },
  ...
}
```

### 2. BonsaiLayout: åº§æ¨™è¨ˆç®—

```
ã‚³ãƒŸãƒƒãƒˆãƒãƒƒãƒ—
    â”‚
    â–¼ ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—æ±ºå®š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ root:   è¦ªãŒãªã„         â”‚
â”‚ trunk:  é€šå¸¸ã®ã‚³ãƒŸãƒƒãƒˆ   â”‚
â”‚ merge:  ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆ   â”‚
â”‚ leaf:   ãƒ–ãƒ©ãƒ³ãƒã®å…ˆç«¯   â”‚
â”‚         å­ãŒãƒãƒ¼ã‚¸ã®ã¿   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼ åº§æ¨™è¨ˆç®—ï¼ˆBFSï¼‰
ãƒ«ãƒ¼ãƒˆ: (400, 750)  â† ç”»é¢ä¸‹éƒ¨ä¸­å¤®
    â”‚
    â–¼ å­ãƒãƒ¼ãƒ‰ã®é…ç½®
angle = calculateAngle()  // è§’åº¦æ±ºå®š
distance = BASE_DISTANCE + depth * DEPTH_FACTOR

// ç•°æ–¹æ€§ã‚¹ã‚±ãƒ¼ãƒ«é©ç”¨ï¼
dx = distance Ã— sin(angle) Ã— 3.0  // æ¨ªæ–¹å‘ Ã—3
dy = distance Ã— cos(angle) Ã— 0.3  // ç¸¦æ–¹å‘ Ã—0.3

å­ã®åº§æ¨™:
  x = è¦ª.x + dx
  y = è¦ª.y - dy  // ä¸Šå‘ãã«æˆé•·
```

### 3. è§’åº¦è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

```
calculateAngle(commit, parent, index, totalChildren)

â”Œâ”€ mainãƒ–ãƒ©ãƒ³ãƒï¼Ÿ
â”‚  YES â†’ 0Â° Â± 10Â° (ã»ã¼å‚ç›´)
â”‚
â””â”€ NO â†’ å­ãŒè¤‡æ•°ï¼Ÿ
       â”‚
       â”œâ”€ YES â†’ -85Â° ã€œ +85Â° ã«å‡ç­‰é…åˆ†
       â”‚         (ã»ã¼æ°´å¹³ã«åºƒãŒã‚‹)
       â”‚
       â””â”€ NO â†’ å˜ä¸€ã®å­
               â”‚
               â”œâ”€ åŒã˜ãƒ–ãƒ©ãƒ³ãƒ â†’ 0Â°
               â””â”€ ç•°ãªã‚‹ãƒ–ãƒ©ãƒ³ãƒ â†’ 75Â° Â± 15Â°
```

## ğŸ¨ SVGãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

```
SVG Canvas (800Ã—800)
â”‚
â”œâ”€ <g id="viewport"> (ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³å¯¾è±¡)
â”‚   â”‚
â”‚   â”œâ”€ <g id="root">      æ¤æœ¨é‰¢
â”‚   â”‚   â””â”€ é€†å°å½¢ + ç¸ + åœŸ
â”‚   â”‚
â”‚   â”œâ”€ <g id="branches">  æï¼ˆç·šï¼‰
â”‚   â”‚   â””â”€ <line> Ã— N
â”‚   â”‚       ãƒ»å¤ªã•: main=16, ãã®ä»–=10
â”‚   â”‚       ãƒ»è‰²: #8B4513ï¼ˆèŒ¶è‰²ï¼‰
â”‚   â”‚
â”‚   â”œâ”€ <g id="nodes">     ç¯€ï¼ˆéè¡¨ç¤ºï¼‰
â”‚   â”‚   â””â”€ ï¼ˆæç”»ã—ãªã„ï¼‰
â”‚   â”‚
â”‚   â””â”€ <g id="leaves">    è‘‰
â”‚       â””â”€ <ellipse> Ã— N
â”‚           ãƒ»ã‚µã‚¤ã‚º: 50ï¼ˆåŸºæœ¬ï¼‰
â”‚           ãƒ»è‰²: #228B22ï¼ˆç·‘ï¼‰
â”‚
â””â”€ <g id="tooltip">       ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
```

### åº§æ¨™ç³»

```
        0                    800 (x)
    0   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
        â”‚   æ¨ªæ–¹å‘ã‚¹ã‚±ãƒ¼ãƒ«Ã—3   â”‚
        â”‚   â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚
        â”‚                     â”‚
        â”‚        ğŸŒ³           â”‚
  ç¸¦æ–¹å‘â”‚                     â”‚
  ã‚¹ã‚±ãƒ¼ãƒ«                    â”‚
   Ã—0.3â”‚        ğŸª´           â”‚
    â†•   â”‚                     â”‚
        â”‚                     â”‚
  800   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   (y)

çµæœ: æ¨ªé•·ã®ç›†æ ½ï¼
```

## ğŸ”‘ ä¸»è¦ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### 1. æ·±ã•è¨ˆç®—ï¼ˆBFSï¼‰

```javascript
calculateDepth(rootCommit, commits, 0) {
  queue = [{commit: root, depth: 0}]
  visited = new Set()

  while (queue.length > 0) {
    {commit, depth} = queue.shift()

    if (visited.has(commit.sha)) continue
    visited.add(commit.sha)

    commit.depth = depth

    for each child in commit.children:
      queue.push({commit: child, depth: depth + 1})
  }
}
```

### 2. è‘‰ã®åˆ¤å®š

```javascript
isLeaf(commit) {
  return (
    // ãƒ–ãƒ©ãƒ³ãƒã®HEAD
    branchHeads.has(commit.sha) ||

    // å­ãŒã„ãªã„
    commit.children.length === 0 ||

    // å­ãŒ1ã¤ã§ãã‚ŒãŒãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆ
    (commit.children.length === 1 &&
     commits.get(commit.children[0]).isMerge)
  )
}
```

### 3. è¡çªè§£æ¶ˆ

```javascript
resolveCollisions(nodes) {
  for (iteration = 0; iteration < 50; iteration++) {
    hasCollision = false

    for each pair (node1, node2):
      distance = sqrt((x1-x2)Â² + (y1-y2)Â²)
      minDistance = size1 + size2 + MARGIN

      if (distance < minDistance) {
        // æŠ¼ã—å‡ºã™
        overlap = minDistance - distance
        adjust = overlap * 0.5

        node1.x -= (dx/distance) * adjust
        node2.x += (dx/distance) * adjust
        ...

        hasCollision = true
      }

    if (!hasCollision) break
  }
}
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ã‚³ãƒŸãƒƒãƒˆæ•°åˆ¶é™

```
git.log({ depth: 1000 })
```

- æœ€å¤§1000ã‚³ãƒŸãƒƒãƒˆã®ã¿å–å¾—
- å¤§è¦æ¨¡ãƒªãƒã‚¸ãƒˆãƒªã§ã‚‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒå›ºã¾ã‚‰ãªã„

### 2. .gitãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿ã‚³ãƒ”ãƒ¼

```javascript
const gitDir = await directoryHandle.getDirectoryHandle('.git');
await this.copyDirectory(gitDir, `${this.dir}/.git`);
```

- ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ãªã„
- youtube-dlã®ã‚ˆã†ãªå¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚é«˜é€Ÿ

### 3. ãƒ«ãƒ¼ãƒ—ãƒ™ãƒ¼ã‚¹ã®æ·±ã•è¨ˆç®—

```javascript
// å†å¸° â†’ ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ âŒ
// ãƒ«ãƒ¼ãƒ—ï¼ˆBFSï¼‰ â†’ OK âœ…
```

## ğŸ¯ ç¾åœ¨ã®è¨­å®šå€¤

```javascript
// bonsai-layout.js
CANVAS_SIZE = 800
BASE_DISTANCE = 50
DEPTH_FACTOR = 2
HORIZONTAL_SCALE = 3.0  // â†æ¨ªã«ä¼¸ã°ã™ï¼
VERTICAL_SCALE = 0.3    // â†ç¸¦ã‚’æŠ‘ãˆã‚‹ï¼
BASE_LEAF_SIZE = 50     // è‘‰ã‚’å¤§ãã

// svg-renderer.js
mainãƒ–ãƒ©ãƒ³ãƒã®å¤ªã• = 16
ãã®ä»–ã®ãƒ–ãƒ©ãƒ³ãƒ = 10
æœ€å¤§å¤ªã• = 25
```

## ğŸŒ³ æç”»ä¾‹

```
           ğŸƒ      ğŸƒ
            \    /
             \  /
         ğŸƒâ”€â”€â”€ğŸ”´â”€â”€â”€ğŸƒ  â† ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆ
              â”‚
         ğŸƒâ”€â”€â”€â”¤â”€â”€â”€ğŸƒ
              â”‚
              â”‚   â† å¤ªã„å¹¹ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒï¼‰
              â”‚
             ğŸª´   â† æ¤æœ¨é‰¢
```

## ğŸ”® ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

- [ ] ã‚³ãƒŸãƒƒãƒˆæ•°ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼èª¿æ•´
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦èª¿æ•´
- [ ] è‰²ãƒ†ãƒ¼ãƒå¤‰æ›´
- [ ] SVGã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å†ç”Ÿæ©Ÿèƒ½
- [ ] ãƒ–ãƒ©ãƒ³ãƒåè¡¨ç¤º
